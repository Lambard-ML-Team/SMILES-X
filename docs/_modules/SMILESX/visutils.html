

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMILESX.visutils &#8212; SMILES-X 2.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/SMILESX/visutils';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">SMILES-X 2.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to SMILES-Xâ€™s documentation!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">SMILESX</a><input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../SMILESX.html">SMILESX package</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Lambard-ML-Team/SMILES-X" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Lambard-ML-Team/SMILES-X/issues/new?title=Issue%20on%20page%20%2F_modules/SMILESX/visutils.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for SMILESX.visutils</h1><div class="highlight"><pre>
<span></span><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;2.1&#39;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Guillaume Lambard, Ekaterina Gracheva&#39;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">AutoMinorLocator</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">average_precision_score</span>

<span class="kn">from</span> <span class="nn">SMILESX</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="c1"># Smooth logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>

<span class="c1"># Learning curve plotting</span>
<div class="viewcode-block" id="learning_curve"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.learning_curve">[docs]</a><span class="k">def</span> <span class="nf">learning_curve</span><span class="p">(</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ifold</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.75</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1">#     plt.title(&#39;&#39;)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">val_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">train_loss</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">val_loss</span><span class="p">))</span><span class="o">+</span><span class="mf">0.005</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span><span class="o">+</span><span class="mf">0.005</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;regression&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss (RMSE, scaled)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss (cross-entropy)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#3783ad&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">val_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#a3cee6&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
        <span class="n">item</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>

    <span class="c1"># Ticks decoration</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
                   <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span>
                   <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
                   <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labeltop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
                   <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span>
                   <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
                   <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ifold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_LearningCurve_Fold_</span><span class="si">{}</span><span class="s1">_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span>\
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">,</span> <span class="n">ifold</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Train&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_LearningCurve_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span>\
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<span class="c1">##</span>

<span class="c1"># Metric curve plotting for LM</span>
<div class="viewcode-block" id="lm_metric_curve"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.lm_metric_curve">[docs]</a><span class="k">def</span> <span class="nf">lm_metric_curve</span><span class="p">(</span><span class="n">train_metric</span><span class="p">,</span> <span class="n">imetrics</span><span class="p">,</span> <span class="n">imetrics_p</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.75</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">train_metric</span><span class="p">)</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_metric</span><span class="p">)</span><span class="o">+</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_metric</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#3783ad&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
        <span class="n">item</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>

    <span class="c1"># Ticks decoration</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
                   <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span>
                   <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
                   <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labeltop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
                   <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span>
                   <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
                   <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">imetrics</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_accuracy&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">imetrics_p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_accuracy&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_MetricCurve_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span>\
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">data_name</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<span class="c1">##</span>

<span class="c1">## Compute diverse scores to quantify model&#39;s performance on classification tasks</span>
<div class="viewcode-block" id="classification_metrics"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.classification_metrics">[docs]</a><span class="k">def</span> <span class="nf">classification_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes precision, recall, F1, support, ROC AUC and PR AUC scores for</span>
<span class="sd">    classification tasks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y_true: list</span>
<span class="sd">        List of true values.</span>
<span class="sd">    y_pred: list</span>
<span class="sd">        List of predicted values.</span>
<span class="sd">    model_type: str</span>
<span class="sd">        Type of the model to be used. Can be either &#39;regression&#39;, &#39;binary_classification&#39;, or &#39;multi_classification&#39;. (Default: &#39;regression&#39;)</span>
<span class="sd">    prec: int</span>
<span class="sd">        Printing precision. (Default: 4)</span>
<span class="sd">    average: str, optional</span>
<span class="sd">        Type of averaging performed on the data. If None, no averaging is</span>
<span class="sd">        performed. (Default: None)</span>
<span class="sd">    labels: list, optional</span>
<span class="sd">        List of labels for classification tasks. (Default: None)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    precision: float</span>
<span class="sd">        Precision score.</span>
<span class="sd">    recall: float</span>
<span class="sd">        Recall score.</span>
<span class="sd">    f1_score: float</span>
<span class="sd">        F1 score.</span>
<span class="sd">    support: int</span>
<span class="sd">        Support.</span>
<span class="sd">    precision_prec: float</span>
<span class="sd">        Precision score with printing precision.</span>
<span class="sd">    recall_prec: float </span>
<span class="sd">        Recall score with printing precision.</span>
<span class="sd">    f1_score_prec: float</span>
<span class="sd">        F1 score with printing precision.</span>
<span class="sd">    roc_auc: float</span>
<span class="sd">        ROC AUC score.</span>
<span class="sd">    prc_auc: float</span>
<span class="sd">        PR AUC score.</span>
<span class="sd">    roc_auc_prec: float</span>
<span class="sd">        ROC AUC score with printing precision.</span>
<span class="sd">    prc_auc_prec: float</span>
<span class="sd">        PR AUC score with printing precision.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract the predicted class</span>
    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;binary_classification&#39;</span><span class="p">:</span>
        <span class="n">y_pred_class</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;multiclass_classification&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">y_pred_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_pred_class</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>

    <span class="c1"># classification report</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">precision_recall_fscore_support</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred_class</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="c1"># replace nan values with 0 in case (precision + recall) = 0</span>
    <span class="n">f1_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">f1_score</span><span class="p">)</span>
    <span class="n">precision_prec</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">recall_prec</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">f1_score_prec</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;multiclass_classification&#39;</span><span class="p">:</span> <span class="c1"># and average == &#39;micro&#39;:</span>
        <span class="n">roc_auc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span> <span class="c1"># ovr -&gt; One-vs-rest: AUC of each class against the rest. Sensitive to class imbalance.</span>
    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;binary_classification&#39;</span><span class="p">:</span>
        <span class="n">prc_auc</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prc_auc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">roc_auc_prec</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">roc_auc</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="k">if</span> <span class="n">roc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">prc_auc_prec</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">prc_auc</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="k">if</span> <span class="n">prc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> <span class="n">precision_prec</span><span class="p">,</span> <span class="n">recall_prec</span><span class="p">,</span> <span class="n">f1_score_prec</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">prc_auc</span><span class="p">,</span> <span class="n">roc_auc_prec</span><span class="p">,</span> <span class="n">prc_auc_prec</span></div>
<span class="c1">##</span>

<div class="viewcode-block" id="print_stats"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.print_stats">[docs]</a><span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">errs_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes, prints and returns RMSE, MAE and R2 for the predictions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trues: list</span>
<span class="sd">        List of train, validation and test true values.</span>
<span class="sd">    preds: list</span>
<span class="sd">        List of train, validation and test predicted values.</span>
<span class="sd">    errs_pred: list, optional</span>
<span class="sd">        List of train, validation and test errors associated with the</span>
<span class="sd">        predictions. (Default: None)</span>
<span class="sd">    prec: int</span>
<span class="sd">        Printing precision. (Default: 4)</span>
<span class="sd">    model_type: str</span>
<span class="sd">        Type of the model to be used. Can be either &#39;regression&#39;, &#39;binary_classification&#39;, or &#39;multi_classification&#39;. (Default: &#39;regression&#39;)</span>
<span class="sd">    labels: list, optional</span>
<span class="sd">        List of labels for classification tasks. (Default: None)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Optionally returns the following values:</span>

<span class="sd">    For regression tasks:</span>
<span class="sd">        rmse_str: str</span>
<span class="sd">            Root mean square error (RMSE) together with error obtained via</span>
<span class="sd">            error propagation based on the input prediction errors.</span>
<span class="sd">        mae_str: float</span>
<span class="sd">            Mean absolute error (MAE) together with error obtained via</span>
<span class="sd">            error propagation based on the input prediction errors.</span>
<span class="sd">        r2_str: float</span>
<span class="sd">            R2 correlation score together with error obtained via</span>
<span class="sd">            error propagation based on the input prediction errors.</span>
<span class="sd">    For classification tasks:</span>
<span class="sd">        acc_str: str</span>
<span class="sd">            Accuracy score.</span>
<span class="sd">        prec_str: str</span>
<span class="sd">            Precision score.</span>
<span class="sd">        recell_str: str</span>
<span class="sd">            Recall score.</span>
<span class="sd">        f1_str: str</span>
<span class="sd">            F1 score.</span>
<span class="sd">        prp_auc_str: str</span>
<span class="sd">            Area under the precision-recall curve. More fitted to imbalanced data than ROC AUC.</span>
<span class="sd">        conf_mat_arr: 2D numpy array</span>
<span class="sd">            Confusion matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: switch to list and back to numpy so that python hinting works</span>
    <span class="c1"># Reason: MyPy compatibility</span>
    <span class="c1">#         For CUDA 10, Tensorflow is 2.3 at max, with number 1.19 at max</span>
    <span class="c1">#         Function numpy.npt, which allows for numpy array hinting, is available from numpy 1.20</span>
    <span class="n">set_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">errs_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">errs_pred</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">errs_pred</span><span class="p">):</span>
        <span class="c1">#true, pred = np.array(true).ravel(), np.array(pred).ravel()</span>

        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;regression&#39;</span><span class="p">:</span>
            <span class="n">true</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
            <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>

            <span class="n">prec_rmse</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">prec_mae</span> <span class="o">=</span> <span class="n">output_prec</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># When used for single run predictions (no standard deviation is available)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Model performance metrics for the &#39;</span> <span class="o">+</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; set:&#39;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged RMSE: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">prec_rmse</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged MAE: {0:</span><span class="si">{1}</span><span class="s2">f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="n">prec_mae</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged R^2: </span><span class="si">{0:0.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span>

                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">err_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">err_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="c1"># When used for fold/total predictions</span>
                <span class="n">d_r2</span> <span class="o">=</span> <span class="n">sigma_r2</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">)</span>
                <span class="n">d_rmse</span> <span class="o">=</span> <span class="n">sigma_rmse</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">)</span>
                <span class="n">d_mae</span> <span class="o">=</span> <span class="n">sigma_mae</span><span class="p">(</span><span class="n">err_pred</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trues</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Final cross-validation statistics:&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model performance metrics for the &quot;</span> <span class="o">+</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; set:&quot;</span><span class="p">)</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged RMSE: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="n">d_rmse</span><span class="p">,</span> <span class="n">prec_rmse</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged MAE: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="n">d_mae</span><span class="p">,</span> <span class="n">prec_mae</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Averaged R^2: </span><span class="si">{0:0.4f}</span><span class="s2">+-</span><span class="si">{1:0.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">d_r2</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rmse</span><span class="p">,</span> <span class="n">d_rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">d_mae</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">d_r2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">model_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;classification&#39;</span><span class="p">:</span>
            <span class="c1">## TODO: add classification metrics per class. With label == None, precision, etc are each returned as a list of scores for each class</span>
            
            <span class="k">if</span> <span class="n">err_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Model performance metrics for the &#39;</span> <span class="o">+</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; set:&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trues</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Final cross-validation statistics:&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Model performance metrics for the &quot;</span> <span class="o">+</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; set:&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i_average</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span> <span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="s1">&#39;weighted&#39;</span><span class="p">]:</span> <span class="c1">#, None]:</span>
                <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">support</span><span class="p">,</span> \
                <span class="n">precision_prec</span><span class="p">,</span> <span class="n">recall_prec</span><span class="p">,</span> <span class="n">f1_score_prec</span><span class="p">,</span> \
                <span class="n">roc_auc</span><span class="p">,</span> <span class="n">prc_auc</span><span class="p">,</span> \
                <span class="n">roc_auc_prec</span><span class="p">,</span> <span class="n">prc_auc_prec</span> <span class="o">=</span> <span class="n">classification_metrics</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> 
                                                                    <span class="n">model_type</span><span class="p">,</span> 
                                                                    <span class="n">prec</span> <span class="o">=</span> <span class="n">prec</span><span class="p">,</span> 
                                                                    <span class="n">average</span> <span class="o">=</span> <span class="n">i_average</span><span class="p">,</span> 
                                                                    <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">i_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">labels</span><span class="p">)</span>
            
                <span class="k">if</span> <span class="n">err_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:}</span><span class="s2"> avg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_average</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;precision: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">precision_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;recall: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">recall_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;f1-score: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">f1_score_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;support: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">support</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">roc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;roc_auc: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roc_auc</span><span class="p">,</span> <span class="n">roc_auc_prec</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;roc_auc: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roc_auc</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">prc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prc_auc: {0:</span><span class="si">{1}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prc_auc</span><span class="p">,</span> <span class="n">prc_auc_prec</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prc_auc: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prc_auc</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">i_average</span> <span class="ow">is</span> <span class="s1">&#39;micro&#39;</span><span class="p">:</span>
                        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">prc_auc</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">prc_auc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">err_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">err_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

                    <span class="n">d_precision</span><span class="p">,</span> <span class="n">d_recall</span><span class="p">,</span> <span class="n">d_f1_score</span><span class="p">,</span> <span class="n">d_support</span><span class="p">,</span> \
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> \
                    <span class="n">d_roc_auc</span><span class="p">,</span> <span class="n">d_prc_auc</span><span class="p">,</span> \
                    <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sigma_classification_metrics</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">,</span> 
                                                        <span class="n">model_type</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">i_average</span><span class="p">,</span> 
                                                        <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">i_average</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">labels</span><span class="p">)</span>
                    
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:}</span><span class="s2"> avg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_average</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;precision: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">d_precision</span><span class="p">,</span> <span class="n">precision_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;recall: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">d_recall</span><span class="p">,</span> <span class="n">recall_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;f1-score: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">d_f1_score</span><span class="p">,</span> <span class="n">f1_score_prec</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;support: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">support</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">roc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;roc_auc: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roc_auc</span><span class="p">,</span> <span class="n">d_roc_auc</span><span class="p">,</span> <span class="n">roc_auc_prec</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;roc_auc: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roc_auc</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">prc_auc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prc_auc: {0:</span><span class="si">{2}</span><span class="s2">f}+-{1:</span><span class="si">{2}</span><span class="s2">f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prc_auc</span><span class="p">,</span> <span class="n">d_prc_auc</span><span class="p">,</span> <span class="n">prc_auc_prec</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prc_auc: </span><span class="si">{0:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prc_auc</span><span class="p">))</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    
                    <span class="n">scores_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">precision</span><span class="p">,</span> <span class="n">d_precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">d_recall</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">d_f1_score</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">,</span> <span class="n">d_roc_auc</span><span class="p">,</span> <span class="n">prc_auc</span><span class="p">,</span> <span class="n">d_prc_auc</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">i_average</span> <span class="ow">is</span> <span class="s1">&#39;micro&#39;</span><span class="p">:</span>
                        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_list</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">iscore</span> <span class="ow">in</span> <span class="n">scores_list</span><span class="p">:</span>
                            <span class="n">outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iscore</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">outputs</span></div>
<span class="c1">##</span>

<span class="c1"># Setup the output format for the dataset automatically, based on the precision requested by user</span>
<div class="viewcode-block" id="output_prec"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.output_prec">[docs]</a><span class="k">def</span> <span class="nf">output_prec</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="c1"># Setup the precision of the displayed error to print it cleanly</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="s1">&#39;0.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># prevent diverging logval if val == 0.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">logval</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">logval</span> <span class="o">&lt;</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="s1">&#39;1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">logval</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="s1">&#39;0.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">logval</span><span class="p">))</span> <span class="o">+</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">precision</span></div>
<span class="c1">##</span>

<span class="c1"># Plot individual plots per run for the internal tests</span>
<div class="viewcode-block" id="plot_fit"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.plot_fit">[docs]</a><span class="k">def</span> <span class="nf">plot_fit</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">errs_true</span><span class="p">,</span> <span class="n">errs_pred</span><span class="p">,</span> <span class="n">err_bars</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dlabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">units</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    true: list</span>
<span class="sd">        List of true values.</span>
<span class="sd">    preds: list</span>
<span class="sd">        List of predicted values.</span>
<span class="sd">    errs_true: list array</span>
<span class="sd">        List or array of errors associated with the true values ([min, max] array</span>
<span class="sd">        or standard deviation list).</span>
<span class="sd">    errs_pred: list</span>
<span class="sd">        List of errors associated with the predicted values (standard deviations</span>
<span class="sd">        computed over augmentations and/or runs).</span>
<span class="sd">    err_bars: {&#39;minmax&#39;,&#39;std&#39;}, optional</span>
<span class="sd">        Format for the error bars to be printed (symmetric for standard deviation,</span>
<span class="sd">        assymetric for [min, max] range).</span>
<span class="sd">    save_dir: str</span>
<span class="sd">        Directory to store the plots into.</span>
<span class="sd">    dname: str</span>
<span class="sd">        Dataset name.</span>
<span class="sd">    dlabel: str</span>
<span class="sd">        Dataset label used for plot titles.</span>
<span class="sd">    units: str</span>
<span class="sd">        Data units used for plot titles.</span>
<span class="sd">    fold: int, optional</span>
<span class="sd">        Cross-validation fold index.</span>
<span class="sd">    run: int, optional</span>
<span class="sd">        Run index.</span>
<span class="sd">    final: bool</span>
<span class="sd">        Whether the plot is built for the final out-of-sample predictions.</span>
<span class="sd">    model_type: str</span>
<span class="sd">        Type of the model to be used. Can be either &#39;regression&#39;, &#39;binary_classification&#39;, or &#39;multi_classification&#39;. (Default: &#39;regression&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">set_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="s1">&#39;Train&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;regression&#39;</span><span class="p">:</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.75</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="c1"># Setting plot limits</span>
        <span class="n">y_true_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trues</span><span class="p">])</span>
        <span class="n">y_true_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trues</span><span class="p">])</span>
        <span class="n">y_pred_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">])</span>
        <span class="n">y_pred_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">])</span>

        <span class="c1"># Expanding slightly the canvas around the data points (by 10%)</span>
        <span class="n">axmin</span> <span class="o">=</span> <span class="n">y_true_min</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">y_true_max</span><span class="o">-</span><span class="n">y_true_min</span><span class="p">)</span>
        <span class="n">axmax</span> <span class="o">=</span> <span class="n">y_true_max</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">y_true_max</span><span class="o">-</span><span class="n">y_true_min</span><span class="p">)</span>
        <span class="n">aymin</span> <span class="o">=</span> <span class="n">y_pred_min</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">y_pred_max</span><span class="o">-</span><span class="n">y_pred_min</span><span class="p">)</span>
        <span class="n">aymax</span> <span class="o">=</span> <span class="n">y_pred_max</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">y_pred_max</span><span class="o">-</span><span class="n">y_pred_min</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">axmin</span><span class="p">,</span> <span class="n">aymin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">axmax</span><span class="p">,</span> <span class="n">aymax</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">axmin</span><span class="p">,</span> <span class="n">aymin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">axmax</span><span class="p">,</span> <span class="n">aymax</span><span class="p">))</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#cc1b00&#39;</span><span class="p">,</span> <span class="s1">&#39;#db702e&#39;</span><span class="p">,</span> <span class="s1">&#39;#519fc4&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">errs_pred</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errs_pred</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_true</span><span class="p">,</span> <span class="n">err_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">errs_true</span><span class="p">,</span> <span class="n">errs_pred</span><span class="p">):</span>
            <span class="c1"># Put the shapes of the errors to the format accepted by matplotlib</span>
            <span class="c1"># (N, ) for symmetric errors, (2, N) for asymmetric errors</span>
            <span class="k">if</span> <span class="n">err_bars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">err_true</span> <span class="o">=</span> <span class="n">error_format</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">err_true</span><span class="p">,</span> <span class="n">err_bars</span><span class="p">)</span>

            <span class="c1"># Legend printing for train/val/test</span>
            <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
                <span class="c1"># No legend is needed for the final out-of-sample prediction</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">true</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                        <span class="n">pred</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
                        <span class="n">xerr</span> <span class="o">=</span> <span class="n">err_true</span><span class="p">,</span>
                        <span class="n">yerr</span> <span class="o">=</span> <span class="n">err_pred</span><span class="p">,</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">set_name</span><span class="p">,</span>
                        <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;#bababa&#39;</span><span class="p">,</span>
                        <span class="n">elinewidth</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                        <span class="n">mfc</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span>
                        <span class="n">markeredgewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Define file name</span>
        <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/</span><span class="si">{}</span><span class="s1">_PredvsTrue_Plot_Final.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Folds/</span><span class="si">{}</span><span class="s1">_PredvsTrue_Plot_Fold_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Runs/</span><span class="si">{}</span><span class="s1">_PredvsTrue_Plot_Fold_</span><span class="si">{}</span><span class="s1">_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>

        <span class="c1"># Plot X=Y line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])],</span>
                <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])],</span>
                <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#595f69&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlabel</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, experimental </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dlabel</span><span class="p">,</span> <span class="n">units</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, prediction </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dlabel</span><span class="p">,</span> <span class="n">units</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
    <span class="c1">#         plt.xlabel(&#39;{}, ground truth {}&#39;.format(dlabel, units), fontsize = 18)</span>
    <span class="c1">#         plt.ylabel(&#39;{}, prediction {}&#39;.format(dlabel, units), fontsize = 18)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground truth </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prediction </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">final</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
            <span class="n">item</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;inout&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
            <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">model_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;classification&#39;</span><span class="p">:</span>
        
        <span class="c1">#TODO(Guillaume): Account for errors when plotting</span>
        <span class="k">for</span> <span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trues</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">errs_pred</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;regression&#39;</span><span class="p">:</span>
                <span class="n">true</span><span class="p">,</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># Extract the predicted class</span>
            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;binary_classification&#39;</span><span class="p">:</span>
                <span class="n">pred_class</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;multiclass_classification&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">pred_class</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pred_class</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>

            <span class="c1"># Legend printing for train/val/test</span>
            <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
                <span class="c1"># No legend is needed for the final out-of-sample prediction</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="s1">&#39;final&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">set_name</span> <span class="o">=</span> <span class="n">set_names</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

            <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred_class</span><span class="p">)</span>
            <span class="n">cm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">conf_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">conf_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">conf_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">set_name</span><span class="o">+</span><span class="s1">&#39; set confusion matrix&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observed label&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>

            <span class="c1"># Define file name</span>
            <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_ConfMatrix_Final.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Folds/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_ConfMatrix_Fold_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Runs/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_ConfMatrix_Fold_</span><span class="si">{}</span><span class="s1">_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;binary_classification&#39;</span><span class="p">:</span>
                <span class="c1"># Precision-recall curve plot </span>
                <span class="c1"># plot the precision-recall curves</span>
                <span class="n">prp_precision</span><span class="p">,</span> <span class="n">prp_recall</span><span class="p">,</span> <span class="n">prp_th</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
                <span class="c1"># calculate f score</span>
                <span class="n">fscore</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">prp_precision</span> <span class="o">*</span> <span class="n">prp_recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">prp_precision</span> <span class="o">+</span> <span class="n">prp_recall</span><span class="p">)</span>
                <span class="c1"># replace nan values with 0 in case (prp_precision + prp_recall) = 0</span>
                <span class="n">fscore</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fscore</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># locate the index of the largest f score</span>
                <span class="n">best_fscore_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">fscore</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> set:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">set_name</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Precision-Recall curve best threshold = </span><span class="si">{0:0.4f}</span><span class="s2">, F1 = </span><span class="si">{1:0.4f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prp_th</span><span class="p">[</span><span class="n">best_fscore_idx</span><span class="p">],</span> <span class="n">fscore</span><span class="p">[</span><span class="n">best_fscore_idx</span><span class="p">]))</span>
                
                <span class="n">random_perf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true</span><span class="p">[</span><span class="n">true</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">random_perf</span><span class="p">,</span> <span class="n">random_perf</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Random&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prp_recall</span><span class="p">,</span> <span class="n">prp_precision</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SMILES-X&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">prp_recall</span><span class="p">[</span><span class="n">best_fscore_idx</span><span class="p">],</span> <span class="n">prp_precision</span><span class="p">[</span><span class="n">best_fscore_idx</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best F1 score&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

                <span class="c1"># Define file name</span>
                <span class="k">if</span> <span class="n">final</span><span class="p">:</span>
                    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_PrecisionRecall_curve_Final.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">run</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Folds/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_PrecisionRecall_curve_Fold_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/Figures/Pred_vs_True/Runs/</span><span class="si">{}</span><span class="s1">_PredvsTrue_</span><span class="si">{}</span><span class="s1">_PrecisionRecall_curve_Fold_</span><span class="si">{}</span><span class="s1">_Run_</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">set_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">,</span> <span class="n">fold</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<span class="c1">##</span>

<div class="viewcode-block" id="error_format"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.error_format">[docs]</a><span class="k">def</span> <span class="nf">error_format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
    <span class="c1"># If any error is given</span>
    <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># If one error value is given, it is treated as standard deviation</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">err</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># If two error values are given, they are treated as [min, max]</span>
        <span class="k">elif</span> <span class="n">err</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Switch from min/max range to the lengths of error bars</span>
            <span class="c1"># to the left/right from the mean or median value</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">err</span><span class="o">-</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># If three error values are given, they are treated as [std, min, max]</span>
        <span class="k">elif</span> <span class="n">err</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bars</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                <span class="c1"># Switch from min/max range to the lengths of error bars</span>
                <span class="c1"># to the left/right from the mean or median value</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">val</span><span class="o">-</span><span class="n">err</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">T</span>
            <span class="k">elif</span> <span class="n">bars</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">err</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;ERROR:&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Error bars format is not understood.&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;SMILES-X execution is aborted.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">StopExecution</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">err</span></div>
<span class="c1">##</span>

<span class="c1"># Compute the error on the estimated R2-score based on the prediction error</span>
<span class="c1"># Checked!</span>
<div class="viewcode-block" id="sigma_r2"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.sigma_r2">[docs]</a><span class="k">def</span> <span class="nf">sigma_r2</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">):</span>
    <span class="n">sstot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">true</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">true</span><span class="p">)))</span>
    <span class="n">sigma_r2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">sstot</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">true</span><span class="o">-</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">err_pred</span><span class="p">)))</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">sigma_r2</span><span class="p">)</span></div>
<span class="c1">##</span>

<span class="c1"># Compute the error on the estimated RMSE based on the prediction error</span>
<span class="c1"># Checked!</span>
<div class="viewcode-block" id="sigma_rmse"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.sigma_rmse">[docs]</a><span class="k">def</span> <span class="nf">sigma_rmse</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">err_pred</span><span class="p">))</span>
    <span class="n">ssres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">true</span> <span class="o">-</span> <span class="n">pred</span><span class="p">))</span>
    <span class="n">sigma_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">true</span><span class="o">-</span><span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">err_pred</span><span class="p">))</span><span class="o">/</span><span class="n">N</span><span class="o">/</span><span class="n">ssres</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">sigma_rmse</span><span class="p">)</span></div>
<span class="c1">##</span>

<span class="c1"># Compute the error on the estimated MAE based on the prediction error</span>
<span class="c1"># Checked!</span>
<div class="viewcode-block" id="sigma_mae"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.sigma_mae">[docs]</a><span class="k">def</span> <span class="nf">sigma_mae</span><span class="p">(</span><span class="n">err_pred</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">err_pred</span><span class="p">))</span>
    <span class="n">sigma_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">err_pred</span><span class="p">)))</span> <span class="o">/</span> <span class="n">N</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">sigma_mae</span><span class="p">)</span></div>
<span class="c1">##</span>

<span class="c1"># Compute the error on the estimated classification scores based on the prediction error</span>
<span class="c1"># via a Monte-Carlo simulation</span>
<div class="viewcode-block" id="sigma_classification_metrics"><a class="viewcode-back" href="../../SMILESX.html#SMILESX.visutils.sigma_classification_metrics">[docs]</a><span class="k">def</span> <span class="nf">sigma_classification_metrics</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">average</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">n_mc</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">err_pred</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_mc</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mc</span><span class="p">):</span>
        <span class="n">pred_mc</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">err_pred</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">classification_metrics</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">pred_mc</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">average</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sigma</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>
<span class="c1">## </span>
</pre></div>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Guillaume Lambard, Ekaterina Gracheva
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2023, Guillaume Lambard, Ekaterina Gracheva.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>